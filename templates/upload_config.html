{% extends "base.html" %} {# Inherit from the base layout #}

{% block title %}Upload & Configure{% endblock %}

{% block head %}
    {# Add any page-specific CSS or meta tags here if needed #}
    <style>
        /* Additional styles specific to this page */
        .config-section { margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid #e5e7eb; }
        .config-section h2 { margin-bottom: 0.75rem; }
        .config-item { margin-bottom: 0.75rem; }
        .config-item label { display: block; margin-bottom: 0.25rem; font-weight: 500; color: #374151; }
        .config-item input[type=text], .config-item input[type=number] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        .config-item input:focus {
             border-color: #4f46e5; /* indigo-600 */
             box-shadow: 0 0 0 1px #4f46e5;
             outline: none;
        }
        .config-item p.help { font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem; }
    </style>
{% endblock %}


{% block navigation %}
    {# Optional: Add specific navigation if needed, or rely on base.html #}
    {# Example: Highlight the 'Upload/Config' link if it existed in base #}
{% endblock %}


{% block content %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">

    {# --- File Upload Section --- #}
    <div class="bg-white p-6 shadow rounded-lg">
        <h2 class="text-xl font-semibold mb-4 text-gray-800">1. Upload Excel File</h2>
        {# Form submits the file to the backend processing route #}
        <form action="{{ url_for('processing.upload_and_process_file') }}" method="post" enctype="multipart/form-data">
            <div class="mb-4">
                <label for="excelFile" class="block text-sm font-medium text-gray-700 mb-1">Select Processed Excel File (.xlsx):</label>
                <input type="file" id="excelFile" name="excelFile" required accept=".xlsx"
                       class="block w-full text-sm text-gray-500
                              file:mr-4 file:py-2 file:px-4
                              file:rounded-md file:border-0
                              file:text-sm file:font-semibold
                              file:bg-indigo-50 file:text-indigo-700
                              hover:file:bg-indigo-100 cursor-pointer border border-gray-300 rounded-md p-1">
                <p class="mt-1 text-xs text-gray-500">Upload the `*_processed.xlsx` file generated by the comparison script.</p>
            </div>
            <div class="text-right">
                <button type="submit"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md text-sm transition duration-150 ease-in-out">
                    Load Data & View Results
                </button>
            </div>
        </form>
         <p class="mt-4 text-xs text-gray-600">
            This will load the comparison data from the uploaded Excel file into the application's cache.
            You can then navigate to the comparison views using the tabs above (once data is loaded).
            The maximum IDs for template functions will also be read from the file's 'Metadata' sheet.
        </p>
    </div>

    {# --- Configuration Editing Section --- #}
    <div class="bg-white p-6 shadow rounded-lg">
        <h2 class="text-xl font-semibold mb-4 text-gray-800">2. Application Configuration</h2>
        <p class="text-sm text-gray-600 mb-4">
            Current settings loaded from <code>config.ini</code>. You can modify these values and save them back to the file.
            Changes will apply the next time the application needs to fetch API data or process sheets (typically requires a restart or specific action not yet implemented).
        </p>
        {# Form submits updated config to the backend #}
        <form action="{{ url_for('processing.update_config') }}" method="post">
            {# --- Files Section --- #}
            <div class="config-section">
                <h3 class="text-lg font-medium text-gray-700">Files</h3>
                <div class="config-item">
                    <label for="config_source_file">Source Excel File (for comparator script):</label>
                    <input type="text" id="config_source_file" name="source_file" value="{{ config.get('source_file', '') }}">
                    <p class="help">Path to the original Excel file used by `excel_comparator.py`.</p>
                </div>
            </div>

            {# --- API Section --- #}
            <div class="config-section">
                <h3 class="text-lg font-medium text-gray-700">API Endpoints</h3>
                 <div class="config-item">
                    <label for="config_dn_url">DN (VQ) URL:</label>
                    <input type="text" id="config_dn_url" name="dn_url" value="{{ config.get('dn_url', '') }}">
                 </div>
                 <div class="config-item">
                    <label for="config_agent_group_url">Agent Group (Skill/VAG/Expr) URL:</label>
                    <input type="text" id="config_agent_group_url" name="agent_group_url" value="{{ config.get('agent_group_url', '') }}">
                 </div>
                 <div class="config-item">
                    <label for="config_api_timeout">API Timeout (seconds):</label>
                    <input type="number" id="config_api_timeout" name="timeout" value="{{ config.get('api_timeout', 15) }}" min="1">
                 </div>
            </div>

             {# --- Sheet Layout Section --- #}
            <div class="config-section">
                 <h3 class="text-lg font-medium text-gray-700">Sheet Layout</h3>
                 <div class="config-item">
                    <label for="config_ideal_agent_header">Ideal Agent Header Text:</label>
                    <input type="text" id="config_ideal_agent_header" name="ideal_agent_header_text" value="{{ config.get('ideal_agent_header_text', '') }}">
                    <p class="help">Text to look for in Row 1 (Cols C/D) to find the Ideal Agent column.</p>
                 </div>
                 <div class="config-item">
                    <label for="config_ideal_agent_fallback">Ideal Agent Fallback Cell:</label>
                    <input type="text" id="config_ideal_agent_fallback" name="ideal_agent_fallback_cell" value="{{ config.get('ideal_agent_fallback_cell', '') }}">
                     <p class="help">Cell coordinate (e.g., C2) to check if header text not found.</p>
                 </div>
                 <div class="config-item">
                    <label for="config_vag_sheet">VAG Extraction Sheet Name:</label>
                    <input type="text" id="config_vag_sheet" name="vag_extraction_sheet" value="{{ config.get('vag_extraction_sheet', '') }}">
                     <p class="help">Exact name of the sheet to extract VAGs from.</p>
                 </div>
            </div>

            <div class="text-right mt-4">
                <button type="submit"
                        class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md text-sm transition duration-150 ease-in-out">
                    Save Configuration to config.ini
                </button>
            </div>
        </form>
    </div>

</div>
{% endblock %}

{% block scripts %}
    {# Add any page-specific JavaScript here #}
    <script>
        // Example: Add JS for file upload preview or validation if needed
        const fileInput = document.getElementById('excelFile');
        if (fileInput) {
            fileInput.addEventListener('change', () => {
                if (fileInput.files.length > 0) {
                    console.log(`File selected: ${fileInput.files[0].name}`);
                    // You could add more sophisticated validation here
                }
            });
        }
    </script>
{% endblock %}

